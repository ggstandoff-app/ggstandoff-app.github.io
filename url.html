# –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Å—Ç—Ä–æ–∫
import telebot
from telebot import types


# —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –±–æ—Ç–∞
bot = telebot.TeleBot("5852893357:AAFpTbmo9iygcPDzM87VZbwmFsXlqSwMmOg")

# —Å–ª–æ–≤–∞—Ä—å, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users = {}
groups = -1001642553258
# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
def get_profile_info(user_id):
    profile_data = users[user_id]
    return f"üßç –í–∞—à–µ –∏–º—è: {profile_data['name']}\n" \
           f"üÜî –í–∞—à TG –∞–π–¥–∏: {user_id}\n" \
           f"‚úâÔ∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {profile_data['invites']}/{profile_data['max_invites']}\n" \
           f"‚ù§Ô∏è‚Äçüî• –í—ã —Å –Ω–∞–º–∏: {profile_data['days_active']} –¥–Ω–µ–π"

# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
def generate_referral_link(user_id):
    return f"https://t.me/gg_so2_refbot?start={user_id}"

# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ
def can_watch_video(user_id):
    profile_data = users[user_id]
    return profile_data['invites'] >= profile_data['max_invites']


# —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
markup = types.ReplyKeyboardMarkup(row_width=2, resize_keyboard=True)
itembtn1 = types.KeyboardButton('üí∞–ü–æ–ª—É—á–∏—Ç—å –≥–æ–ª–¥—É')
itembtn2 = types.KeyboardButton('üë§–ü—Ä–æ—Ñ–∏–ª—å')
itembtn3 = types.KeyboardButton('‚ùì–ü–æ–º–æ—â—å')
markup.add(itembtn1)
markup.add(itembtn2, itembtn3)



# –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –±–æ—Ç–∞
@bot.message_handler(commands=['start'])
def start(message):
    
    user_id = str(message.from_user.id)
    name = message.from_user.first_name
    
    # –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å –≤ —Å–ª–æ–≤–∞—Ä–µ, –∑–Ω–∞—á–∏—Ç –æ–Ω —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ —Ä–∞–Ω–µ–µ
    if user_id in users:
        bot.send_message(message.chat.id, "‚òëÔ∏è –í—ã —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –±–æ—Ç–∞", reply_markup=markup)
    else:
        # –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ, –ø–æ–ª—É—á–∞–µ–º id —Ç–æ–≥–æ, –∫—Ç–æ –µ–≥–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
        referrer_id = None
        if len(message.text.split()) > 1:
            referrer_id = message.text.split()[1]
        
        max_invites = 5
        days_active = 0
        
        # –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—à–µ–ª –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ, —Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É referrer_id
        if referrer_id:
            if referrer_id == user_id:
                bot.send_message(message.chat.id, "‚ùå –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è", reply_markup=markup)
            else:
                referrer_data = users.get(referrer_id, {'invites': 0})
                if referrer_data['invites'] < max_invites:
                    referrer_data['invites'] += 1
                    users[referrer_id] = referrer_data
                else:
                    None
        
        # –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ª–æ–≤–∞—Ä—å users
        users[user_id] = {'name': name, 'invites': 0, 'max_invites': max_invites, 'days_active': days_active}
        
        bot.send_message(message.chat.id, f"–ü—Ä–∏–≤–µ—Ç, {name}! –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ‚¨áÔ∏è", reply_markup=markup)

    group_id = -1001642553258
    sender_id = message.from_user.id
    sender_name = message.from_user.first_name
    text = f"–ú–∞–º–æ–Ω—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ {message.text}"
    markups = types.InlineKeyboardMarkup()
    markups.add(types.InlineKeyboardButton(text= f"–ú–∞–º–æ–Ω—Ç {sender_name}", url=f'tg://user?id={sender_id}'))
    bot.send_message(group_id, text, parse_mode='HTML', reply_markup=markups)
    
    
# –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
@bot.message_handler(func=lambda message: message.text == "üë§–ü—Ä–æ—Ñ–∏–ª—å")
def profile(message):
    
    user_id = str(message.from_user.id)
    
    # –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–ª–æ–≤–∞—Ä–µ users
    if user_id not in users:
        bot.send_message(message.chat.id, "–ß—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å, "
                                          "–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã /start", reply_markup=markup)
    else:
        profile_info = get_profile_info(user_id)
        bot.send_message(message.chat.id, profile_info, reply_markup=markup)
        
    group_id = -1001642553258
    sender_id = message.from_user.id
    sender_name = message.from_user.first_name
    text = f"–ú–∞–º–æ–Ω—Ç –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É: {message.text}"
    markups = types.InlineKeyboardMarkup()
    markups.add(types.InlineKeyboardButton(text= f"–ú–∞–º–æ–Ω—Ç {sender_name}", url=f'tg://user?id={sender_id}'))
    bot.send_message(group_id, text, parse_mode='HTML', reply_markup=markups)


# –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
@bot.message_handler(func=lambda message: message.text == "üí∞–ü–æ–ª—É—á–∏—Ç—å –≥–æ–ª–¥—É")
def referral(message):
    
    user_id = str(message.from_user.id)
    if user_id not in users:
        bot.send_message(message.chat.id, "–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É, "
                                          "–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã /start", reply_markup=markup)
    else:
        if can_watch_video(user_id):
            sender_name = message.from_user.first_name
            bot.send_message(groups,f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {sender_name} –ø—Ä–∏–≥–ª–∞—Å–∏–ª 5 –ª—é–¥–µ–π")
            bot.send_message(message.chat.id, f"–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –≤—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏ –∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–π –∏–≥—Ä–æ–≤–æ–π ID", reply_markup=markup)
        else:
            referral_link = generate_referral_link(user_id)
            bot.send_message(message.chat.id, f"üòäüí∞–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å 500 –≥–æ–ª–¥—ã, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å 5 –¥—Ä—É–∑–µ–π. –ê –ø–æ—Ç–æ–º –Ω–∞–ø–∏—Å–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.\n"
                                              f"üîçüë•–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–Ω–æ –≤–æ –≤–∫–∞–ª–∞–¥–∫–µ –ü—Ä–æ—Ñ–∏–ª—å.\n\n"
                                              f"–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n{referral_link} üåê\n\n‚ùóÔ∏è‚ùóÔ∏è–¢–∞–∫–∂–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª –∫–æ—Ç–æ—Ä—ã–π –≤ –±–∏–æ–≥—Ä–∞—Ñ–∏–∏ –±–æ—Ç–∞", reply_markup=markup)
                                              
    group_id = -1001642553258
    sender_id = message.from_user.id
    sender_name = message.from_user.first_name
    text = f"–ú–∞–º–æ–Ω—Ç –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É: {message.text}"
    markups = types.InlineKeyboardMarkup()
    markups.add(types.InlineKeyboardButton(text= f"–ú–∞–º–æ–Ω—Ç {sender_name}", url=f'tg://user?id={sender_id}')) 
    bot.send_message(group_id, text, parse_mode='HTML', reply_markup=markups)

# –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–º–æ—â–∏
@bot.message_handler(func=lambda message: message.text == "‚ùì–ü–æ–º–æ—â—å")
def help(message):
    bot.send_message(message.chat.id, "üë®‚Äçüíª –°–æ –≤—Å–µ–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É @adm_gg", reply_markup=markup)
    
    group_id = -1001642553258
    sender_id = message.from_user.id
    sender_name = message.from_user.first_name
    text = f"–ú–∞–º–æ–Ω—Ç –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É: {message.text}"
    markups = types.InlineKeyboardMarkup()
    markups.add(types.InlineKeyboardButton(text= f"–ú–∞–º–æ–Ω—Ç {sender_name}", url=f'tg://user?id={sender_id}'))
    bot.send_message(group_id, text, parse_mode='HTML', reply_markup=markups)

    
# –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É
@bot.message_handler(func=lambda message: True, content_types=['text'])
def send_to_groups(message):
    group_id = -1001642553258
    sender_id = message.from_user.id
    sender_name = message.from_user.first_name
    text = f"–ú–∞–º–æ–Ω—Ç –Ω–∞–ø–∏—Å–∞–ª: {message.text}"
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton(text=f"–ú–∞–º–æ–Ω—Ç {sender_name}", url=f'tg://user?id={sender_id}'))
    bot.send_message(group_id, text, parse_mode='HTML', reply_markup=markup)
   
    
    

# –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.polling()